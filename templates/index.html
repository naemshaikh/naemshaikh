<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MrBlack Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg:           #f0f1f3;
            --bg2:          #e8eaed;
            --surface:      #ffffff;
            --card:         #ffffff;
            --card2:        #f7f8fa;
            --border:       rgba(0,0,0,0.08);
            --border2:      rgba(0,0,0,0.14);
            --shadow:       0 2px 12px rgba(0,0,0,0.07);
            --shadow-lg:    0 8px 32px rgba(0,0,0,0.10);

            --ink:          #181a1f;
            --ink2:         #4a4f5c;
            --ink3:         #9198a8;
            --ink4:         #c2c7d0;

            --accent:       #1a1d24;
            --accent2:      #2d3140;

            --green:        #12b76a;
            --green-bg:     rgba(18,183,106,0.09);
            --green-border: rgba(18,183,106,0.22);

            --red:          #f04438;
            --red-bg:       rgba(240,68,56,0.09);
            --red-border:   rgba(240,68,56,0.22);

            --amber:        #e68a00;
            --amber-bg:     rgba(230,138,0,0.09);
            --amber-border: rgba(230,138,0,0.22);

            --blue:         #3b82f6;
            --blue-bg:      rgba(59,130,246,0.09);

            --radius-sm:    8px;
            --radius-md:    14px;
            --radius-lg:    20px;
            --radius-xl:    28px;
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg);
            color: var(--ink);
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* â”€â”€ HEADER â”€â”€ */
        .header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 14px 18px 12px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0; z-index: 50;
            box-shadow: 0 1px 0 var(--border);
        }
        .header-left { display: flex; align-items: center; gap: 11px; }
        .logo-icon {
            width: 36px; height: 36px;
            background: var(--accent);
            border-radius: 11px;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: 800; color: #fff; letter-spacing: -0.5px;
        }
        .brand-wrap { display: flex; align-items: center; gap: 8px; }
        .brand-name { font-size: 18px; font-weight: 800; color: var(--ink); letter-spacing: -0.5px; }
        .live-pill {
            display: flex; align-items: center; gap: 4px;
            background: var(--green-bg); border: 1px solid var(--green-border);
            color: var(--green); border-radius: 20px;
            padding: 2px 9px; font-size: 10px; font-weight: 600;
            font-family: 'DM Mono', monospace;
        }
        .live-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

        .bnb-pill {
            display: flex; align-items: center; gap: 6px;
            background: var(--card2); border: 1px solid var(--border2);
            border-radius: 20px; padding: 5px 11px;
            font-size: 12px; font-weight: 600; color: var(--ink2);
            font-family: 'DM Mono', monospace; cursor: default;
        }
        .bnb-pill .bnb-logo { font-size: 14px; }

        .header-right { display: flex; align-items: center; gap: 8px; }
        .icon-btn {
            width: 36px; height: 36px; border-radius: 10px;
            background: var(--card2); border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; color: var(--ink3); cursor: pointer;
            transition: all 0.18s;
        }
        .icon-btn:active { background: var(--border2); color: var(--ink); }

        /* â”€â”€ TABS â”€â”€ */
        .tabs {
            display: flex; gap: 4px;
            background: var(--surface);
            padding: 8px 14px 0;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }
        .tab {
            flex: 1; padding: 8px 6px 10px;
            font-size: 12px; font-weight: 600;
            color: var(--ink3); cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.18s; text-align: center;
            display: flex; align-items: center; justify-content: center; gap: 5px;
            letter-spacing: 0.2px;
        }
        .tab i { font-size: 12px; }
        .tab.active { color: var(--accent); border-bottom-color: var(--accent); }

        /* â”€â”€ PANELS â”€â”€ */
        .panel { display: none; flex: 1; overflow: hidden; flex-direction: column; }
        .panel.active { display: flex; }

        /* â”€â”€ SCROLL AREAS â”€â”€ */
        .scroll-area {
            flex: 1; overflow-y: auto; padding: 14px;
            display: flex; flex-direction: column; gap: 10px;
        }
        .scroll-area::-webkit-scrollbar { width: 3px; }
        .scroll-area::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 10px; }

        /* â”€â”€ CARDS â”€â”€ */
        .card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: var(--radius-md); padding: 14px;
            box-shadow: var(--shadow);
        }

        /* â”€â”€ ALERT â”€â”€ */
        .alert-danger {
            display: none; background: var(--red-bg); border: 1px solid var(--red-border);
            border-radius: var(--radius-md); padding: 10px 14px;
            font-size: 12px; font-weight: 600; color: var(--red); text-align: center;
        }

        /* â”€â”€ STATS GRID â”€â”€ */
        .stats-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; }
        .stat-card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: var(--radius-md); padding: 12px 10px;
            text-align: center; box-shadow: var(--shadow);
            transition: transform 0.15s, box-shadow 0.15s;
        }
        .stat-card:active { transform: scale(0.97); }
        .stat-label {
            font-size: 9px; letter-spacing: 1.2px; text-transform: uppercase;
            color: var(--ink3); font-family: 'DM Mono', monospace; margin-bottom: 6px;
        }
        .stat-val {
            font-size: 16px; font-weight: 700;
            font-family: 'DM Mono', monospace; line-height: 1;
        }
        .stat-sub { font-size: 9px; color: var(--ink4); margin-top: 3px; font-family: 'DM Mono', monospace; }
        .c-green { color: var(--green); }
        .c-red   { color: var(--red); }
        .c-amber { color: var(--amber); }
        .c-ink   { color: var(--ink2); }

        /* â”€â”€ MODE TOGGLE â”€â”€ */
        .mode-card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: var(--radius-md); padding: 12px 14px;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: var(--shadow);
        }
        .mode-label { font-size: 13px; font-weight: 600; color: var(--ink2); }
        .toggle-wrap { display: flex; background: var(--bg2); border-radius: 10px; padding: 3px; gap: 3px; }
        .mode-btn {
            padding: 6px 16px; border-radius: 8px; font-size: 11px; font-weight: 700;
            border: none; background: transparent; color: var(--ink3);
            cursor: pointer; font-family: 'DM Mono', monospace; transition: all 0.18s;
        }
        .mode-btn.on-paper {
            background: var(--surface); color: var(--green);
            box-shadow: 0 1px 4px rgba(0,0,0,0.10);
        }
        .mode-btn.on-real {
            background: var(--surface); color: var(--red);
            box-shadow: 0 1px 4px rgba(0,0,0,0.10);
        }

        /* â”€â”€ SECTION HEADER â”€â”€ */
        .sec-head {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 8px;
        }
        .sec-title {
            font-size: 10px; font-weight: 700; letter-spacing: 1.5px;
            text-transform: uppercase; color: var(--ink3); font-family: 'DM Mono', monospace;
        }
        .sec-badge {
            font-size: 9px; background: var(--blue-bg); color: var(--blue);
            border-radius: 20px; padding: 2px 8px; font-weight: 600;
            font-family: 'DM Mono', monospace;
        }

        /* â”€â”€ PAIRS CHIPS â”€â”€ */
        .pairs-scroll { display: flex; gap: 7px; overflow-x: auto; padding-bottom: 2px; }
        .pairs-scroll::-webkit-scrollbar { display: none; }
        .pair-chip {
            flex-shrink: 0;
            background: var(--card2); border: 1px solid var(--border);
            border-radius: 20px; padding: 6px 14px;
            font-size: 11px; font-family: 'DM Mono', monospace;
            white-space: nowrap; cursor: pointer;
            transition: all 0.15s; color: var(--ink2);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .pair-chip:active { background: var(--accent); color: #fff; border-color: var(--accent); }
        .pair-chip.new { border-color: var(--amber-border); color: var(--amber); background: var(--amber-bg); }
        .pair-chip.scanning { color: var(--ink4); font-style: italic; }

        /* â”€â”€ POSITIONS â”€â”€ */
        .pos-card {
            background: var(--card); border: 1px solid var(--border);
            border-radius: var(--radius-md); padding: 12px 14px;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: var(--shadow);
        }
        .pos-token { font-weight: 700; font-size: 13px; }
        .pos-meta { font-size: 10px; color: var(--ink3); margin-top: 2px; font-family: 'DM Mono', monospace; }
        .pos-pnl { text-align: right; font-family: 'DM Mono', monospace; font-weight: 700; }
        .pnl-pct { font-size: 15px; }
        .pnl-usd { font-size: 10px; color: var(--ink3); }
        .empty-msg { font-size: 12px; color: var(--ink4); text-align: center; padding: 18px 0; }

        /* â”€â”€ EXPOSURE BAR â”€â”€ */
        .exp-row { display: flex; justify-content: space-between; margin-bottom: 7px; }
        .exp-label { font-size: 12px; color: var(--ink3); }
        .exp-val { font-size: 12px; font-family: 'DM Mono', monospace; color: var(--ink2); font-weight: 600; }
        .bar-track { background: var(--bg2); border-radius: 20px; height: 5px; overflow: hidden; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, var(--accent2), var(--accent)); border-radius: 20px; transition: width 0.5s ease; }

        /* â”€â”€ ACTION BUTTONS â”€â”€ */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .action-btn {
            background: var(--card); border: 1px solid var(--border);
            border-radius: var(--radius-md); padding: 13px 10px;
            font-size: 12px; font-weight: 600; color: var(--ink);
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 7px;
            transition: all 0.15s; box-shadow: var(--shadow); font-family: 'Outfit', sans-serif;
        }
        .action-btn:active { transform: scale(0.96); box-shadow: none; }
        .action-btn .ico { font-size: 13px; }
        .btn-scan .ico  { color: var(--accent); }
        .btn-close .ico { color: var(--red); }
        .btn-bal .ico   { color: var(--amber); }
        .btn-trend .ico { color: var(--blue); }

        /* â”€â”€ CHAT â”€â”€ */
        .chat-wrap { flex:1; display:flex; flex-direction:column; overflow:hidden; }
        .messages {
            flex:1; overflow-y:auto; padding:14px 14px 6px;
            display:flex; flex-direction:column; gap:10px;
        }
        .messages::-webkit-scrollbar { width: 3px; }
        .messages::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 10px; }

        .msg-row { display:flex; }
        .msg-row.user { justify-content: flex-end; }
        .msg-row.bot  { justify-content: flex-start; }

        .bubble {
            max-width: 83%; padding: 10px 14px; font-size: 13px;
            line-height: 1.55; border-radius: 18px; word-break: break-word;
        }
        .bubble.user {
            background: var(--accent); color: #fff;
            border-bottom-right-radius: 5px;
        }
        .bubble.bot {
            background: var(--card); border: 1px solid var(--border);
            color: var(--ink); border-bottom-left-radius: 5px;
            box-shadow: var(--shadow);
        }
        .bot-lbl {
            font-size: 9px; letter-spacing: 1px; font-family: 'DM Mono', monospace;
            color: var(--ink3); margin-bottom: 4px; text-transform: uppercase;
        }

        .typing-dots span {
            display: inline-block; width: 6px; height: 6px;
            background: var(--ink3); border-radius: 50%; margin: 0 2px;
            animation: tdot 1.2s infinite;
        }
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes tdot { 0%,60%,100%{transform:translateY(0);opacity:0.3} 30%{transform:translateY(-5px);opacity:1} }

        .suggestions {
            padding: 6px 14px; display: flex; gap: 6px;
            overflow-x: auto; flex-shrink: 0;
        }
        .suggestions::-webkit-scrollbar { display: none; }
        .sugg {
            flex-shrink: 0; background: var(--card); border: 1px solid var(--border);
            border-radius: 20px; padding: 6px 12px; font-size: 11px; cursor: pointer;
            color: var(--ink2); white-space: nowrap; transition: all 0.15s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .sugg:active { background: var(--accent); color: #fff; border-color: var(--accent); }

        /* â”€â”€ INPUT BAR â”€â”€ */
        .input-bar {
            padding: 8px 14px 14px; background: var(--surface);
            border-top: 1px solid var(--border); flex-shrink: 0;
        }
        .input-row { display: flex; gap: 8px; align-items: center; }
        .chat-input {
            flex: 1; background: var(--card2); border: 1px solid var(--border);
            border-radius: 25px; padding: 11px 18px; font-size: 13px;
            color: var(--ink); font-family: 'Outfit', sans-serif;
            outline: none; transition: border-color 0.18s;
        }
        .chat-input:focus { border-color: var(--border2); background: var(--surface); }
        .chat-input::placeholder { color: var(--ink4); }
        .send-btn {
            width: 44px; height: 44px; border-radius: 50%;
            background: var(--accent); border: none; color: #fff;
            font-size: 15px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0; transition: transform 0.15s, opacity 0.15s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.18);
        }
        .send-btn:active { transform: scale(0.88); opacity: 0.85; }

        /* â”€â”€ SCAN â”€â”€ */
        .scan-area { flex:1; overflow-y:auto; padding:14px; display:flex; flex-direction:column; gap:10px; }
        .scan-area::-webkit-scrollbar { display:none; }
        .scan-input { width:100%; background: var(--card2); border:1px solid var(--border); border-radius:var(--radius-sm); padding:11px 14px; font-size:12px; color:var(--ink); font-family:'DM Mono',monospace; outline:none; transition:border-color 0.18s; margin-bottom:10px; }
        .scan-input:focus { border-color: var(--border2); }
        .scan-input::placeholder { color: var(--ink4); }
        .scan-btn {
            width:100%; padding:12px; background:var(--accent); border:none; border-radius:var(--radius-sm);
            color:#fff; font-size:13px; font-weight:700; cursor:pointer; font-family:'Outfit',sans-serif;
            transition:opacity 0.18s; display:flex; align-items:center; justify-content:center; gap:7px;
        }
        .scan-btn:active { opacity:0.85; }

        .check-item {
            display:flex; align-items:center; gap:10px; background:var(--card);
            border:1px solid var(--border); border-radius:var(--radius-sm); padding:10px 12px;
        }
        .check-dot { width:9px; height:9px; border-radius:50%; flex-shrink:0; background:var(--ink4); }
        .check-dot.pass { background:var(--green); box-shadow:0 0 6px rgba(18,183,106,0.4); }
        .check-dot.fail { background:var(--red);   box-shadow:0 0 6px rgba(240,68,56,0.4); }
        .check-dot.warn { background:var(--amber); }
        .check-text { font-size:12px; flex:1; color:var(--ink2); }
        .check-badge { font-size:9px; font-family:'DM Mono',monospace; padding:2px 7px; border-radius:10px; font-weight:600; }
        .badge-pass { background:var(--green-bg); color:var(--green); }
        .badge-fail { background:var(--red-bg);   color:var(--red); }
        .badge-warn { background:var(--amber-bg); color:var(--amber); }

        .score-card {
            display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;
        }
        .score-lbl { font-size:13px; font-weight:700; color:var(--ink); }
        .score-val { font-size:22px; font-weight:800; font-family:'DM Mono',monospace; }

        /* Divider */
        .divider { height:1px; background:var(--border); margin:2px 0; }
    </style>
</head>
<body>

<!-- HEADER -->
<div class="header">
    <div class="header-left">
        <div class="logo-icon">MB</div>
        <div class="brand-wrap">
            <span class="brand-name">MrBlack</span>
            <span class="live-pill"><span class="live-dot"></span>LIVE</span>
        </div>
    </div>
    <div class="header-right">
        <div class="bnb-pill" id="bnbPill">
            <span class="bnb-logo">â¬¡</span>
            <span id="bnbPriceVal">$â€”</span>
        </div>
        <div class="icon-btn" onclick="fetchTradingData()"><i class="fas fa-sync-alt" id="refreshIcon"></i></div>
        <div class="icon-btn"><i class="fas fa-bell"></i></div>
    </div>
</div>

<!-- TABS -->
<div class="tabs">
    <div class="tab active" onclick="switchTab('dashboard')"><i class="fas fa-chart-bar"></i> Dashboard</div>
    <div class="tab" onclick="switchTab('chat')"><i class="fas fa-robot"></i> Chat</div>
    <div class="tab" onclick="switchTab('scan')"><i class="fas fa-search"></i> Scan</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel active" id="panel-dashboard">
    <div class="scroll-area">

        <!-- Daily Loss Alert -->
        <div class="alert-danger" id="dailyLossAlert">ğŸ›‘ DAILY LOSS LIMIT REACHED â€” Aaj aur trade mat karo!</div>

        <!-- Row 1: PAPER / REAL / PNL -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">PAPER</div>
                <div class="stat-val c-green" id="paperBal">â€”</div>
                <div class="stat-sub">BNB</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">REAL</div>
                <div class="stat-val c-red" id="realBal">0.00</div>
                <div class="stat-sub">BNB</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">PNL 24H</div>
                <div class="stat-val c-ink" id="pnlVal">â€”</div>
                <div class="stat-sub" id="pnlUsd">loading...</div>
            </div>
        </div>

        <!-- Row 2: F&G / WIN RATE / TRADES -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">F&amp;G</div>
                <div class="stat-val c-ink" id="fearGreedVal">â€”</div>
                <div class="stat-sub">/100</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">WIN RATE</div>
                <div class="stat-val c-ink" id="winRateVal">â€”</div>
                <div class="stat-sub">% trades</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">TRADES</div>
                <div class="stat-val c-ink" id="tradeCountVal">â€”</div>
                <div class="stat-sub">total</div>
            </div>
        </div>

        <!-- Mode Toggle -->
        <div class="mode-card">
            <span class="mode-label">Trading Mode</span>
            <div class="toggle-wrap">
                <button class="mode-btn on-paper" id="btnPaper" onclick="setMode('paper')">PAPER</button>
                <button class="mode-btn" id="btnReal" onclick="setMode('real')">REAL</button>
            </div>
        </div>

        <!-- New BSC Pairs -->
        <div class="card">
            <div class="sec-head">
                <span class="sec-title">ğŸ†• NEW PAIRS â€” BSC</span>
                <span class="sec-badge" id="pairsStatus">scanning...</span>
            </div>
            <div class="pairs-scroll" id="pairsContainer">
                <div class="pair-chip scanning">Scanning BSC...</div>
            </div>
        </div>

        <!-- Open Positions -->
        <div>
            <div class="sec-head">
                <span class="sec-title">ğŸ“‚ OPEN POSITIONS</span>
                <span class="sec-badge" id="posCountBadge">0</span>
            </div>
            <div id="positionsList">
                <div class="empty-msg">Loading positions...</div>
            </div>
        </div>

        <!-- Portfolio Exposure -->
        <div class="card">
            <div class="exp-row">
                <span class="exp-label">Portfolio Exposure</span>
                <span class="exp-val" id="exposureTxt">â€”% / 65%</span>
            </div>
            <div class="bar-track">
                <div class="bar-fill" id="exposureBar" style="width:0%"></div>
            </div>
        </div>

        <!-- Actions -->
        <div class="action-grid">
            <button class="action-btn btn-scan" onclick="goScan()">
                <span class="ico"><i class="fas fa-search"></i></span> Scan Token
            </button>
            <button class="action-btn btn-trend" onclick="prefillChat('Market trend kya hai aaj?')">
                <span class="ico"><i class="fas fa-chart-line"></i></span> Market Trend
            </button>
            <button class="action-btn btn-close" onclick="prefillChat('Close all positions')">
                <span class="ico"><i class="fas fa-times-circle"></i></span> Close All
            </button>
            <button class="action-btn btn-bal" onclick="prefillChat('Paper trading balance aur performance batao')">
                <span class="ico"><i class="fas fa-wallet"></i></span> Balance
            </button>
        </div>

        <!-- Monitoring -->
        <div class="card">
            <div class="exp-row">
                <span class="exp-label">ğŸ” Monitoring</span>
                <span class="exp-val" id="monitorCount">â€”</span>
            </div>
            <div class="exp-row" style="margin-bottom:0;">
                <span class="exp-label">ğŸ“š Learning Cycles</span>
                <span class="exp-val" id="learningCycles">â€”</span>
            </div>
        </div>

    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CHAT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel" id="panel-chat">
    <div class="chat-wrap">
        <div class="messages" id="messages"></div>
        <div class="suggestions">
            <div class="sugg" onclick="sendSugg('Paper trading balance kya hai?')">ğŸ“ Paper Balance</div>
            <div class="sugg" onclick="sendSugg('Market trend kya hai aaj?')">ğŸ“Š Market Trend</div>
            <div class="sugg" onclick="sendSugg('Meri positions close karo')">âŒ Close Positions</div>
            <div class="sugg" onclick="sendSugg('Risk settings batao')">âš™ï¸ Risk Settings</div>
            <div class="sugg" onclick="sendSugg('Bot kya sikh raha hai?')">ğŸ§  Learning</div>
        </div>
        <div class="input-bar">
            <div class="input-row">
                <input id="chatInput" class="chat-input" type="text"
                    placeholder="Kuch bhi poocho..." autocomplete="off">
                <button class="send-btn" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCAN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel" id="panel-scan">
    <div class="scan-area">
        <div class="card">
            <div class="sec-title" style="margin-bottom:10px;">ğŸ” TOKEN SCANNER</div>
            <input id="scanAddr" class="scan-input" type="text"
                placeholder="Contract address 0x... paste karo">
            <button class="scan-btn" id="scanBtn" onclick="runScan()">
                <i class="fas fa-search"></i> Scan Token
            </button>
        </div>

        <div id="scanResult" style="display:none;">
            <div class="sec-title" style="margin-bottom:8px;">âœ… CHECKLIST RESULT</div>
            <div class="card" style="margin-bottom:8px;">
                <div class="score-card">
                    <span class="score-lbl">Safety Score</span>
                    <span class="score-val c-green" id="safetyScore">â€”</span>
                </div>
                <div class="bar-track">
                    <div class="bar-fill" id="safetyBar" style="width:0%"></div>
                </div>
            </div>
            <div style="display:flex; flex-direction:column; gap:6px;" id="checklistItems"></div>
        </div>

        <div>
            <div class="sec-title" style="margin-bottom:8px;">ğŸ“‹ RECENT SCANS</div>
            <div id="recentScans">
                <div class="empty-msg">Koi scan nahi hua abhi</div>
            </div>
        </div>
    </div>
</div>

<script>
// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentMode = 'paper';
let sessionId   = null;
let recentScans = [];

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function initSession() {
    try {
        const r = await fetch('/init-session', { method: 'POST' });
        const d = await r.json();
        sessionId = d.session_id;
    } catch {
        sessionId = 'local-' + Date.now();
    }
}

// â”€â”€â”€ TAB SWITCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(tab) {
    const names = ['dashboard','chat','scan'];
    document.querySelectorAll('.tab').forEach((t,i) => t.classList.toggle('active', names[i] === tab));
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.getElementById('panel-'+tab).classList.add('active');
    if (tab === 'chat') document.getElementById('chatInput').focus();
}

// â”€â”€â”€ MODE SWITCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setMode(m) {
    currentMode = m;
    document.getElementById('btnPaper').className = 'mode-btn' + (m==='paper' ? ' on-paper' : '');
    document.getElementById('btnReal').className  = 'mode-btn' + (m==='real'  ? ' on-real'  : '');
    addMessage(`Mode switched to <strong>${m.toUpperCase()}</strong> trading, bhai! ğŸ¯`, 'bot');
    switchTab('chat');
}

// â”€â”€â”€ CHAT HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addMessage(html, who) {
    const msgs = document.getElementById('messages');
    const row  = document.createElement('div');
    row.className = 'msg-row ' + who;
    row.innerHTML = who === 'bot'
        ? `<div class="bubble bot"><div class="bot-lbl">â— MrBlack</div>${html}</div>`
        : `<div class="bubble user">${html}</div>`;
    msgs.appendChild(row);
    msgs.scrollTop = msgs.scrollHeight;
}

function addTyping() {
    const msgs = document.getElementById('messages');
    const row  = document.createElement('div');
    row.id = 'typing-ind'; row.className = 'msg-row bot';
    row.innerHTML = `<div class="bubble bot"><div class="bot-lbl">â— MrBlack</div>
        <div class="typing-dots"><span></span><span></span><span></span></div></div>`;
    msgs.appendChild(row); msgs.scrollTop = msgs.scrollHeight;
}

async function sendMessage() {
    const inp  = document.getElementById('chatInput');
    const text = inp.value.trim();
    if (!text) return;
    addMessage(text, 'user');
    inp.value = '';
    addTyping();
    try {
        const r = await fetch('/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: text, session_id: sessionId, user_name: 'Naem', mode: currentMode })
        });
        const data = await r.json();
        document.getElementById('typing-ind')?.remove();
        addMessage(data.reply || 'Koi reply nahi aaya, bhai.', 'bot');
        if (data.trading) updateStats(data.trading);
    } catch {
        document.getElementById('typing-ind')?.remove();
        addMessage('âš ï¸ Network error, bhai! Connection check karo.', 'bot');
    }
}

function sendSugg(text) { document.getElementById('chatInput').value = text; sendMessage(); }
function prefillChat(text) { switchTab('chat'); document.getElementById('chatInput').value = text; document.getElementById('chatInput').focus(); }
function goScan() { switchTab('scan'); }
function scanFromPair(addr) { switchTab('scan'); document.getElementById('scanAddr').value = addr; }

document.getElementById('chatInput').addEventListener('keypress', e => { if (e.key==='Enter') sendMessage(); });

// â”€â”€â”€ SCAN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function runScan() {
    const addr = document.getElementById('scanAddr').value.trim();
    if (!addr) { alert('Address daalo pehle!'); return; }
    const btn  = document.getElementById('scanBtn');
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Scanning...';
    btn.disabled  = true;
    document.getElementById('scanResult').style.display = 'none';
    try {
        const r    = await fetch('/scan', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ address: addr, session_id: sessionId })
        });
        const data = await r.json();
        renderChecklist(data);
        addRecentScan(addr, data);
    } catch { alert('Scan fail hua, bhai. Dobara try karo.'); }
    btn.innerHTML = '<i class="fas fa-search"></i> Scan Token';
    btn.disabled  = false;
}

function renderChecklist(data) {
    const items  = data.checklist || defaultChecklist();
    const passed = items.filter(i => i.status === 'pass').length;
    const total  = items.length;
    const pct    = Math.round(passed / total * 100);

    document.getElementById('checklistItems').innerHTML = items.map(item =>
        `<div class="check-item">
            <div class="check-dot ${item.status}"></div>
            <div class="check-text">${item.label}</div>
            <span class="check-badge badge-${item.status}">${item.value}</span>
        </div>`
    ).join('');

    const cls = pct >= 75 ? 'c-green' : pct >= 50 ? 'c-amber' : 'c-red';
    const bgc = pct >= 75
        ? 'linear-gradient(90deg,var(--green),#00c8a0)'
        : pct >= 50
        ? 'linear-gradient(90deg,var(--amber),#ff9500)'
        : 'linear-gradient(90deg,var(--red),#ff6b6b)';
    document.getElementById('safetyScore').className = 'score-val ' + cls;
    document.getElementById('safetyScore').textContent = passed + '/' + total;
    const bar = document.getElementById('safetyBar');
    bar.style.width = pct + '%'; bar.style.background = bgc;
    document.getElementById('scanResult').style.display = 'block';
}

function defaultChecklist() {
    return [
        { label:'Contract Verified',   status:'pass', value:'YES'     },
        { label:'Honeypot Check',       status:'pass', value:'SAFE'   },
        { label:'Liquidity Locked',     status:'warn', value:'30 DAYS'},
        { label:'Owner Renounced',      status:'pass', value:'YES'    },
        { label:'Buy Tax',              status:'pass', value:'3%'     },
        { label:'Sell Tax',             status:'warn', value:'7%'     },
        { label:'Holders > 100',        status:'pass', value:'842'    },
        { label:'Top 10 Holders < 30%', status:'fail', value:'41%'   },
    ];
}

function addRecentScan(addr, data) {
    const short = addr.length > 14 ? addr.slice(0,8)+'...'+addr.slice(-4) : addr;
    recentScans.unshift({ short, full:addr, data });
    if (recentScans.length > 5) recentScans.pop();
    document.getElementById('recentScans').innerHTML = recentScans.map((s,i) =>
        `<div class="check-item" onclick="renderChecklist(recentScans[${i}].data);document.getElementById('scanAddr').value=recentScans[${i}].full;" style="cursor:pointer;">
            <div class="check-dot pass"></div>
            <div class="check-text" style="font-family:'DM Mono',monospace;font-size:11px;">${s.short}</div>
            <span class="check-badge badge-pass">VIEW</span>
        </div>`
    ).join('');
}

// â”€â”€â”€ TRADING DATA UPDATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStats(d) {
    if (!d) return;

    // Row 1
    if (d.paper   !== undefined) { var el=document.getElementById('paperBal'); if(el) el.textContent = parseFloat(d.paper).toFixed(3); }
    if (d.real    !== undefined) { var el=document.getElementById('realBal');  if(el) el.textContent = parseFloat(d.real).toFixed(3); }
    if (d.pnl     !== undefined) {
        var el=document.getElementById('pnlVal'); if(el) {
            el.textContent = d.pnl;
            el.className = 'stat-val ' + (String(d.pnl).includes('-') ? 'c-red' : 'c-green');
        }
    }
    if (d.pnl_pct !== undefined) {
        var el=document.getElementById('pnlVal'); if(el && !d.pnl) {
            el.textContent = (d.pnl_pct >= 0 ? '+' : '') + d.pnl_pct + '%';
            el.className   = 'stat-val ' + (d.pnl_pct >= 0 ? 'c-green' : 'c-red');
        }
    }
    if (d.paper_usd !== undefined) { var el=document.getElementById('pnlUsd'); if(el) { var v=String(d.paper_usd); el.textContent = v.startsWith('$') ? v : '$'+v; } }

    // BNB Price
    if (d.bnb_price !== undefined) {
        var el=document.getElementById('bnbPriceVal');
        if(el) el.textContent = '$' + parseFloat(d.bnb_price).toFixed(0);
    }

    // Row 2
    if (d.fear_greed !== undefined) {
        var el=document.getElementById('fearGreedVal'); if(el) {
            el.textContent = d.fear_greed;
            var fg = parseInt(d.fear_greed);
            el.className = 'stat-val ' + (fg > 60 ? 'c-green' : fg > 40 ? 'c-amber' : 'c-red');
        }
    }
    if (d.win_rate !== undefined) {
        var el=document.getElementById('winRateVal'); if(el) {
            el.textContent = parseFloat(d.win_rate).toFixed(1);
            el.className = 'stat-val ' + (parseFloat(d.win_rate) >= 50 ? 'c-green' : 'c-red');
        }
    }
    if (d.trade_count !== undefined) { var el=document.getElementById('tradeCountVal'); if(el) el.textContent = d.trade_count; }
    if (d.total_trades !== undefined) { var el=document.getElementById('tradeCountVal'); if(el) el.textContent = d.total_trades; }

    // Monitoring & Learning
    if (d.monitoring !== undefined || d.new_pairs_found !== undefined) {
        var el=document.getElementById('monitorCount'); if(el) el.textContent = (d.monitoring || d.new_pairs_found || 'â€”') + ' tokens';
    }
    if (d.learning_cycles !== undefined) { var el=document.getElementById('learningCycles'); if(el) el.textContent = d.learning_cycles + ' cycles'; }

    // Exposure - multiple possible field names
    var expVal = d.exposure || d.portfolio_exposure || d.used_exposure || d.risk_used;
    if (expVal !== undefined) {
        var pct = parseFloat(expVal);
        var el=document.getElementById('exposureTxt'); if(el) el.textContent = pct.toFixed(0) + '% / 65%';
        var bar=document.getElementById('exposureBar'); if(bar) bar.style.width = Math.min(pct/0.65, 100) + '%';
    } else {
        var el=document.getElementById('exposureTxt'); if(el && el.textContent === 'â€”% / 65%') el.textContent = '0% / 65%';
    }

    // Daily Loss
    if (d.limit_reached) { var el=document.getElementById('dailyLossAlert'); if(el) el.style.display='block'; }

    // Positions
    if (d.positions && Array.isArray(d.positions)) renderPositions(d.positions, d.bnb_price || 300);
}

function renderPositions(positions, bnbPrice) {
    var list = document.getElementById('positionsList');
    var badge = document.getElementById('posCountBadge');
    if (!list) return;
    if (!positions || positions.length === 0) {
        list.innerHTML = '<div class="empty-msg">Koi open position nahi hai abhi</div>';
        if (badge) badge.textContent = '0';
        return;
    }
    if (badge) badge.textContent = positions.length;
    list.innerHTML = positions.map(function(pos) {
        var pnl   = parseFloat(pos.pnl_pct || 0);
        var cls   = pnl >= 0 ? 'c-green' : 'c-red';
        var sign  = pnl >= 0 ? '+' : '';
        var usd   = Math.abs((pos.size_bnb||0) * pnl/100 * bnbPrice).toFixed(2);
        return '<div class="pos-card">'
            + '<div><div class="pos-token">'+(pos.token||pos.name||'Unknown')+'</div>'
            + '<div class="pos-meta">Entry: '+(pos.entry_price||'â€”')+' Â· '+(pos.size_bnb||'â€”')+' BNB</div></div>'
            + '<div class="pos-pnl"><div class="pnl-pct '+cls+'">'+ sign+pnl.toFixed(1)+'%</div>'
            + '<div class="pnl-usd">'+(pnl>=0?'+':'-')+'$'+usd+'</div></div></div>';
    }).join('');
}

// â”€â”€â”€ FETCH LIVE DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function fetchTradingData() {
    var icon = document.getElementById('refreshIcon');
    if (icon) icon.classList.add('fa-spin');
    try {
        const r    = await fetch('/trading-data');
        const data = await r.json();
        updateStats(data);
        fetchNewPairs();
    } catch (e) { console.warn('Trading data fetch failed:', e); }
    if (icon) setTimeout(() => icon.classList.remove('fa-spin'), 600);
}

async function fetchNewPairs() {
    var container = document.getElementById('pairsContainer');
    var statusBadge = document.getElementById('pairsStatus');
    try {
        const r = await fetch('/new-pairs');
        if (r.status === 404) { throw new Error('no endpoint'); }
        const data = await r.json();
        var pairs = data.pairs || data.new_pairs || (Array.isArray(data) ? data : []);
        if (!pairs || pairs.length === 0) {
            if (statusBadge) statusBadge.textContent = 'scanning...';
            if (container) container.innerHTML = '<div class="pair-chip scanning">BSC scan chal raha hai...</div>';
            return;
        }
        if (statusBadge) statusBadge.textContent = pairs.length + ' found';
        if (container) {
            container.innerHTML = pairs.slice(0, 8).map(function(p) {
                var name = p.name || p.symbol || p.token || p.pair || 'Token';
                var addr = p.address || p.contract || p.token_address || '';
                var isHot = p.hot || p.trending || false;
                return '<div class="pair-chip' + (isHot ? ' new' : '') + '" onclick="scanFromPair(\'' + addr + '\')">'
                    + name + (isHot ? ' ğŸ”¥' : '') + '</div>';
            }).join('');
        }
    } catch {
        // /new-pairs nahi hai â€” trading-data se monitored tokens dikhao
        if (statusBadge) statusBadge.textContent = 'live';
        if (container && container.children.length <= 1) {
            container.innerHTML = '<div class="pair-chip scanning">Monitoring active pairs...</div>';
        }
    }
}

// â”€â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function boot() {
    await initSession();
    addMessage('Bhai! MrBlack Pro ready hai ğŸš€<br>Dashboard mein live stats dekho Â· Chat mein poocho Â· Scan karo koi bhi token.', 'bot');
    fetchTradingData();
    setInterval(fetchTradingData, 15000);
    setInterval(fetchNewPairs, 30000);
}

boot();
</script>
</body>
</html>
